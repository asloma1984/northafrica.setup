#!/usr/bin/env bash
set -euo pipefail

SESSION="northafrica"
LOG="/var/log/northafrica-install.log"
SCRIPT_URL="https://install.my-north-africa.com/premium.sh"

[[ $EUID -eq 0 ]] || { echo "Run as root"; exit 1; }

export DEBIAN_FRONTEND=noninteractive

apt-get update -y >/dev/null 2>&1 || true
apt-get install -y curl wget ca-certificates tmux >/dev/null 2>&1

# لو الجلسة شغالة لا نعيد
if tmux has-session -t "$SESSION" 2>/dev/null; then
  echo "Installer already running"
  exit 0
fi

cat >/root/.na_run.sh <<'EOF'
#!/usr/bin/env bash
set -euo pipefail
LOG="/var/log/northafrica-install.log"
SCRIPT_URL="https://install.my-north-africa.com/premium.sh"

exec > >(tee -a "$LOG") 2>&1

echo "NorthAfrica installation started..."

curl -fsSL "$SCRIPT_URL" -o /root/premium.sh
chmod +x /root/premium.sh
bash /root/premium.sh

echo "Install finished, rebooting..."
sleep 5
reboot
EOF

chmod +x /root/.na_run.sh
tmux new-session -d -s "$SESSION" "bash /root/.na_run.sh"

clear
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo " NorthAfrica Installer Running"
echo " Please wait..."
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo " Server will reboot automatically"
