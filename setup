#!/usr/bin/env bash
set -euo pipefail

REPO="asloma1984/northafrica.setup"
BRANCH="main"
DIR="/root/northafrica.setup"
SESSION="northafrica"

export DEBIAN_FRONTEND=noninteractive

apt update -y
apt install -y git tmux curl wget ca-certificates

rm -rf "$DIR"
git clone --depth 1 -b "$BRANCH" "https://github.com/$REPO.git" "$DIR"

chmod +x "$DIR/installer.sh"

# Run in tmux (like your friend's style)
if [[ -z "${TMUX:-}" ]]; then
  tmux new-session -d -s "$SESSION" "bash $DIR/installer.sh; echo; echo 'DONE âœ…'; read -n 1"
  echo "Install is running in tmux: $SESSION"
  echo "Attach: tmux attach -t $SESSION"
  exit 0
fi

bash "$DIR/installer.sh"